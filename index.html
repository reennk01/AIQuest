<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Captioner</title>
  <style>
    body { font-family: Arial; max-width:700px; margin:24px auto; }
    #preview { max-width:100%; height:auto; }
    .btn { padding:8px 12px; margin:6px; }
    #caption { margin-top:12px; font-size:18px; font-weight:600; }
    #raw { font-size:12px; color:#444; white-space:pre-wrap; margin-top:10px; background:#f4f4f4; padding:8px; border-radius:6px; }
  </style>
</head>
<body>
  <h2>AI Caption Generator (Azure)</h2>
  <input type="file" id="file" accept="image/*" />
  <button class="btn" id="btn">Generate Caption</button>
  <div>
    <img id="preview" src="" alt="" />
  </div>
  <div id="caption"></div>
  <div id="raw"></div>

<script>
const FUNC_URL = '/api/caption'; // replace

const fileInput = document.getElementById('file');
const preview = document.getElementById('preview');
const btn = document.getElementById('btn');
const captionDiv = document.getElementById('caption');
const rawDiv = document.getElementById('raw');

let lastBase64 = null;
fileInput.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    preview.src = reader.result;
    lastBase64 = reader.result;
  };
  reader.readAsDataURL(file);
});

btn.addEventListener('click', async () => {
  captionDiv.textContent = 'Generating captionâ€¦';
  rawDiv.textContent = '';
  try {
    const body = { imageBase64: lastBase64 };
    const r = await fetch(FUNC_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    const j = await r.json();
    captionDiv.textContent = j.caption ? `ðŸ“¸ ${j.caption}` : 'No caption found';
    rawDiv.textContent = JSON.stringify(j.raw || j, null, 2);
  } catch (err) {
    captionDiv.textContent = 'Error calling server';
    rawDiv.textContent = err;
  }
});
</script>
</body>
</html>
